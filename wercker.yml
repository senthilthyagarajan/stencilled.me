box: debian
build:
  steps:
    - script:
        name: Install Hugo
        code: |
          wget https://github.com/gohugoio/hugo/releases/download/v0.125.7/hugo_extended_0.125.7_linux-amd64.deb
          sudo dpkg -i hugo_extended_0.125.7_linux-amd64.deb
          hugo version
    - script:
        name: Build Hugo site
        code: |
          hugo --theme=PaperMod --buildDrafts=false --minify
    - script:
        name: List built files
        code: |
          ls -la public/posts/
          echo "Checking for verifiable agents post:"
          find public/posts/ -name "*verifiable*" -type d

deploy:
  steps:
    - arjen/s3sync:
        key-id: $AWS_ACCESS_S3_KEY_ID
        key-secret: $AWS_ACCESS_S3_KEY_SECRET
        bucket-url: $AWS_S3_BUCKET_URL
        source_dir: public/
        opts: --acl-public --add-header=Cache-Control:max-age=3600
